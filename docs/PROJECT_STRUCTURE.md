# LANShare P2P 项目结构

## 目录结构

```
LANShare/
├── README.md                 # 项目主要文档
├── go.mod                    # Go 模块文件
├── go.sum                    # Go 依赖锁定文件
├── build.sh                  # 构建脚本
├── start_p2p.sh             # 启动脚本
├── p2p_client.go            # P2P客户端源代码
├── build/                   # 构建输出目录
│   └── lanshare_p2p         # P2P可执行文件
├── docs/                    # 文档目录
│   └── PROJECT_STRUCTURE.md # 项目结构说明
└── examples/                # 示例和演示文件（预留）
```

## 文件说明

### 核心文件

- **README.md**: 项目主要文档，包含使用说明、功能介绍等
- **go.mod/go.sum**: Go 模块管理文件
- **build.sh**: 构建脚本，用于编译P2P客户端
- **start_p2p.sh**: P2P客户端的便捷启动脚本

### 源代码文件

- **p2p_client.go**: P2P版本的完整实现，包含：
  - 自动服务发现
  - P2P连接管理
  - 消息处理
  - 用户界面
  - 网卡选择功能

### 构建输出

- **build/**: 编译后的可执行文件存放目录
  - **lanshare_p2p**: P2P版本可执行文件

### 文档和示例

- **docs/**: 项目文档目录
- **examples/**: 示例文件目录（预留用于未来的使用示例）

## 构建流程

### 使用构建脚本（推荐）
```bash
./build.sh
```

### 手动构建
```bash
# 创建构建目录
mkdir -p build

# 构建P2P版本
go build -o build/lanshare_p2p p2p_client.go
```

## 运行方式

### P2P版本
```bash
# 使用启动脚本
./start_p2p.sh [用户名]

# 直接运行
./build/lanshare_p2p [用户名]
```

## 开发指南

### 添加新功能

在 `p2p_client.go` 中添加新的消息类型和处理逻辑：

1. **定义新消息类型**: 在 `Message` 结构体中添加新的类型
2. **添加处理逻辑**: 在 `handleMessages()` 函数中添加处理代码
3. **用户界面**: 在 `handleCommand()` 函数中添加新命令

### 代码组织原则

- **单一职责**: 每个函数负责特定功能
- **模块化**: 功能按模块分离
- **清晰命名**: 函数和变量名称清晰表达用途
- **文档完整**: 重要功能都有相应注释

### 核心功能模块

#### 1. 网络发现模块
- `getLocalIP()`: 获取本地IP地址，支持多网卡选择
- `startDiscovery()`: 启动服务发现
- `listenBroadcast()`: 监听UDP广播
- `sendDiscoveryBroadcast()`: 发送服务发现广播

#### 2. 连接管理模块
- `connectToPeer()`: 连接到对等节点
- `acceptConnections()`: 接受传入连接
- `handlePeerConnection()`: 处理对等节点连接

#### 3. 消息处理模块
- `handleMessages()`: 处理接收到的消息
- `broadcastMessage()`: 广播消息到所有节点
- `sendMessageToPeer()`: 发送消息到特定节点

#### 4. 用户界面模块
- `userInterface()`: 用户交互界面
- `handleCommand()`: 处理用户命令
- `listPeers()`: 列出在线用户

## 部署建议

### 开发环境
- 使用 `./build.sh` 进行开发构建
- 使用 `./start_p2p.sh` 快速测试功能

### 生产环境
- 使用构建脚本生成可执行文件
- 确保网络配置正确（端口开放等）
- 在可信网络环境中使用

## 网络架构

### 端口分配
- **TCP 8888**: P2P通信端口
- **UDP 9999**: 服务发现端口

### 通信流程
1. **启动阶段**: 节点启动，选择网卡，开始广播
2. **发现阶段**: 监听广播，发现其他节点
3. **连接阶段**: 建立TCP连接，交换握手信息
4. **通信阶段**: 进行消息传输和用户交互

## 扩展计划

### 短期目标
- 文件传输功能
- 表情包支持
- 消息历史记录

### 中期目标
- 桌面分享功能
- 群组管理
- 消息加密

### 长期目标
- Web界面
- 移动端支持
- 跨平台兼容性

## 技术特点

### 优势
- **去中心化**: 无需中央服务器
- **自动发现**: 零配置网络发现
- **实时通信**: 低延迟P2P通信
- **简单部署**: 单文件部署

### 限制
- **局域网限制**: 仅支持同一局域网
- **安全性**: 当前版本未加密
- **扩展性**: 大量节点时性能可能下降

## 故障排除

### 常见问题
1. **无法发现节点**: 检查防火墙和网络配置
2. **连接失败**: 确认端口未被占用
3. **消息丢失**: 检查网络稳定性

### 调试方法
- 查看控制台输出
- 检查网络连接状态
- 使用网络工具测试端口连通性

## 贡献指南

### 代码贡献
1. Fork 项目
2. 创建功能分支
3. 提交代码更改
4. 创建 Pull Request

### 问题报告
- 使用 GitHub Issues
- 提供详细的错误信息
- 包含复现步骤

## 许可证

本项目采用开源许可证，欢迎社区贡献。
